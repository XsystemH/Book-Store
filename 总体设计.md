# 总体设计

## 对象

### 1.Book

**查询相关**: 
ISBN号（20 个字符，每本正版书都有惟一的标识）、书名（60 个字符、作者（60 个字符）、关键字（可以有多个，总共不超过 60 个字符）

**购买相关**: 
库存量（整型）、单价（非负实数）；

### 2.User

用户的建立


- 默认游客 (基类)
  > enum 权限等级 // 用于记录权限等级
  >
  > 注册() // 获取ID(查重) 和密码(两次验证)，创建账户，储存至本地文件
- 顾客 (派生)
  > string ID
  >
  > string Password
  >
  > 查询() // 输入查询的相关信息，列出所有符合条件的图书
  >
  > 购买() // 输入书本信息 发起购买
  >
  > 修改密码() // 验证密码 修改密码
- 店员 (派生自顾客)
  > 添加图书() // 读入图书信息 保存至本地
  > 
  > 图书信息修改()
  > 
  > 进货() // 找到对应图书 修改库存数量 记录批次的进价
- 店长 (派生自店员)
  > 修改权限()
  >
  > 日志查询()
  >
  > 购买记录查询()


账户的操作

- 
    > 登入 登出()
    > 
    > 密码修改()
    >
    > 注销账户()
    > 

### 3.Log


#### BookLog

采购信息（即按照采购顺序输出采购图书的 ISBN 号、数量、单价等）、销售情况（即按照销售顺序输出售出图书的 ISBN 号、数量、单价等）、盈利信息（即输出该段时间的收入，支出以及利润）

#### AllLog

操作发起时间 发起人 事件类型 操作对象 是否成功进行

    实现对特定操作者的操作的查询

## 储存模式

### Books

使用二进制文件来存储所有图书的相关信息。(确保长度一定 可以快速读取)

文件内部采用块状链表结构。分为ISBN_list和Details，用于存储信息。

在ISBN_list文件中，所有图书的信息按照ISBN值的排列。每个节点中存储了对应图书信息块在Details文件中的起始位置，每个节点在二进制文件中所占用的字节数应相同（补零？）

在Details文件中，每个链表节点下按照ISBN值从小到大的顺序存储图书的各个信息。

使用书名、作者名和关键词作为索引 减少查询某一具体内容时的时间花费

### logs

1. 系统日志

    - 在一个文件中，按时间顺序记录所有操作，操作者，操作时间
    - 在另一个文件中建立索引，记录块状链表中某块的起止时间，以及在文件一中的对应位置
    - 每个用户单独建立文档显然会超出20个文件的预算，考虑一某一数字n作为划分，给每个用户单独预留区域建立索引。超过n则重新申请一份空间并建立索引

2. 交易日志

    - 记录图书购入与售出情况
    - 统计营业额与成本投入
    - 索引同上
    - 另外采购和售出应当考虑是否分别单独各建立一个索引文件(待定)

## 系统约束

**开发语言**: c++

**界面**: 命令行